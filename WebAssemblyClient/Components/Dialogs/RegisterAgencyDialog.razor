@implements IDialogContentComponent<RegisterAgencyDto>
<EditForm EditContext="_editContext">
    <DataAnnotationsValidator />
    
    <FluentGrid Spacing="2">
        <FluentGridItem xs="6">
            <FluentStack Orientation="Orientation.Vertical" VerticalGap="0">
                <FluentTextField @bind-Value="Content.FirstName"
                                 Label="Nome"
                                 Required>
                </FluentTextField>
                <FluentValidationMessage For="@(() => Content.FirstName)"/>
            </FluentStack>
        </FluentGridItem>

        <FluentGridItem xs="6">
            <FluentStack Orientation="Orientation.Vertical" VerticalGap="0">
                <FluentTextField @bind-Value="Content.LastName"
                                 Label="Cognome"
                                 Required>
                </FluentTextField>
                <FluentValidationMessage For="@(() => Content.LastName)"/>
            </FluentStack>
        </FluentGridItem>
        
        <FluentGridItem xs="12">
            <FluentStack Orientation="Orientation.Vertical" VerticalGap="0">
                <FluentTextField @bind-Value="Content.Email"
                                 Label="Email"
                                 Required
                                 TextFieldType="TextFieldType.Email"
                                 Style="width: 100%">
        
                </FluentTextField> 
                <FluentValidationMessage For="@(() => Content.Email)"/>
            </FluentStack>
        </FluentGridItem>
        
        <FluentGridItem xs="12">
            <FluentStack Orientation="Orientation.Vertical" VerticalGap="0">
                <FluentTextField @bind-Value="Content.AgencyName"
                                 Label="Nome dell'azienda"
                                 Required
                                 TextFieldType="TextFieldType.Password"
                                 Style="width: 100%">
                </FluentTextField>
                <FluentValidationMessage For="@(() => Content.AgencyName)"/>
            </FluentStack>
        </FluentGridItem>
        
    </FluentGrid>
</EditForm>

<FluentDialogFooter>
    <FluentStack HorizontalAlignment="HorizontalAlignment.End">
        <FluentButton Appearance="Appearance.Accent"
                      OnClick="@CloseAsync">
            Registrati
        </FluentButton>
        <FluentButton Appearance="Appearance.Neutral"
                      OnClick="@Discard">
            Annulla
        </FluentButton>
    </FluentStack>
</FluentDialogFooter>

@code {
    [Parameter]
    public RegisterAgencyDto Content { get; set; } = default!;
    
    [CascadingParameter]
    public FluentDialog? Dialog {get; set; }
    private EditContext _editContext = default!;
    
    protected override void OnInitialized()
    {
        _editContext = new EditContext(Content);
    }
    
    private async Task CloseAsync()
    {
        if (_editContext.Validate())
        {
            await Dialog!.CloseAsync(Content);
        }
    }
    
    private async Task Discard()
    {
        if (Dialog != null)
        {
            await Dialog.CancelAsync();
        }
    }
}
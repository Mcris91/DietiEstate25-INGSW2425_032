@implements IDialogContentComponent<UserRequestDto>
<EditForm EditContext="_editContext">
    <DataAnnotationsValidator />
    
    <FluentGrid Spacing="2">
        <FluentGridItem xs="6">
            <FluentStack Orientation="Orientation.Vertical" VerticalGap="0">
                <FluentTextField @bind-Value="Content.FirstName"
                                 Label="Nome"
                                 Required>
                </FluentTextField>
                <FluentValidationMessage For="@(() => Content.FirstName)"/>
            </FluentStack>
        </FluentGridItem>

        <FluentGridItem xs="6">
            <FluentStack Orientation="Orientation.Vertical" VerticalGap="0">
                <FluentTextField @bind-Value="Content.LastName"
                                 Label="Cognome"
                                 Required>
                </FluentTextField>
                <FluentValidationMessage For="@(() => Content.LastName)"/>
            </FluentStack>
        </FluentGridItem>
        
        <FluentGridItem xs="12">
            <FluentStack Orientation="Orientation.Vertical" VerticalGap="0">
                <FluentTextField @bind-Value="Content.Email"
                                 Label="Email"
                                 Required
                                 TextFieldType="TextFieldType.Email"
                                 Style="width: 100%">
        
                </FluentTextField> 
                <FluentValidationMessage For="@(() => Content.Email)"/>
            </FluentStack>
        </FluentGridItem>
        
        <FluentGridItem xs="12">
            <FluentStack Orientation="Orientation.Vertical" VerticalGap="0">
                <FluentTextField @bind-Value="Content.Password"
                                 Label="Password"
                                 Required
                                 TextFieldType="TextFieldType.Password"
                                 Style="width: 100%">
                </FluentTextField>
                <FluentValidationMessage For="@(() => Content.Password)"/>
            </FluentStack>
        </FluentGridItem>
        
        <FluentGridItem xs="12">
            <FluentStack Orientation="Orientation.Vertical" VerticalGap="0">
                <FluentTextField @bind-Value="_confirmPassword"
                                 Label="Conferma Password*"
                                 Required
                                 TextFieldType="TextFieldType.Password"
                                 Style="width: 100%">
                </FluentTextField>
                @if (_differentPassword)
                {
                    <FluentLabel Color="Color.Error">Le password sono diverse</FluentLabel>
                }
            </FluentStack>
        </FluentGridItem>
    </FluentGrid>
</EditForm>

<FluentDialogFooter>
    <FluentStack HorizontalAlignment="HorizontalAlignment.End">
        <FluentButton Appearance="Appearance.Accent"
                      OnClick="@CloseAsync">
            Registrati
        </FluentButton>
        <FluentButton Appearance="Appearance.Neutral"
                      OnClick="@Discard">
            Annulla
        </FluentButton>
    </FluentStack>
</FluentDialogFooter>
@code {
    [Parameter]
    public UserRequestDto Content { get; set; } = default!;
    
    [CascadingParameter]
    public FluentDialog? Dialog {get; set; }
    private EditContext _editContext = default!;
    private string _confirmPassword = String.Empty;
    private bool _differentPassword;

    
    protected override void OnInitialized()
    {
        _editContext = new EditContext(Content);
    }
    
    private async Task CloseAsync()
    {
        _differentPassword = !string.Equals(Content.Password, _confirmPassword);
        if (_editContext.Validate() && !_differentPassword)
        {
            await Dialog!.CloseAsync(Content);
        }
    }
    
    private async Task Discard()
    {
        if (Dialog != null)
        {
            await Dialog.CancelAsync();
        }
    }
}
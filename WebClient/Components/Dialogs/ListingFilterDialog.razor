@using DietiEstate.WebClient.Data.Requests
@implements IDialogContentComponent<ListingFilterDto>

<FluentStack Orientation="Orientation.Vertical" VerticalGap="20">
    
    <FluentStack Orientation="Orientation.Vertical">
        <FluentStack Orientation="Orientation.Horizontal">
            <FluentIcon Value="@(new Icons.Regular.Size24.Home())" Color="@Color.Accent"/>
            <FluentLabel Typo="Typography.H5">Tipologia</FluentLabel>
        </FluentStack>
        
        <FluentSelect TOption="Option<string>"
                      Items="ListingTypes"
                      OptionText="@(i => i.Text)"
                      OptionValue="@(i => i.Value)"
                      Width="100%"
                      @bind-Value="@Content.TypeCode"/>
    </FluentStack>

    <FluentStack Orientation="Orientation.Vertical">
        <FluentStack Orientation="Orientation.Horizontal">
            <FluentIcon Value="@(new Icons.Regular.Size24.Flash())" Color="@Color.Accent"/>
            <FluentLabel Typo="Typography.H5">Classe energetica</FluentLabel>
        </FluentStack>

        <FluentSelect TOption="Option<string>"
                      Items="ListingEnergeticClasses"
                      OptionText="@(i => i.Text)"
                      OptionValue="@(i => i.Value)"
                      Width="100%"
                      @bind-Value="@Content.EnergyClass"/>
    </FluentStack>
    
    <FluentStack Orientation="Orientation.Vertical">
        <FluentStack Orientation="Orientation.Horizontal">
            <FluentIcon Value="@(new Icons.Regular.Size24.Tag())" Color="@Color.Accent"/>
            <FluentLabel Typo="Typography.H5">Servizi nelle vicinanze</FluentLabel>
        </FluentStack>

        <FluentAutocomplete TOption="Option<string>"
                            Items="_availableTags"
                            OptionText="@(t => t.Text)"
                            @bind-SelectedOptions="@_selectedOptions"
                            Placeholder="Seleziona servizi..."
                            autocomplete="off" 
                            Width="100%" />
    </FluentStack>
    
    <FluentStack Orientation="Orientation.Vertical">
        <FluentStack Orientation="Orientation.Horizontal">
            <FluentIcon Value="@(new Icons.Regular.Size24.Money())" Color="@Color.Accent"/>
            <FluentLabel Typo="Typography.H5">Prezzo</FluentLabel>
        </FluentStack>
        
        <FluentStack Orientation="Orientation.Horizontal">
            <FluentNumberField TValue="decimal?" Label="Da" @bind-Value="Content.MinPrice" autocomplete="off"></FluentNumberField>
            <FluentNumberField TValue="decimal?" Label="A" @bind-Value="Content.MaxPrice" autocomplete="off"></FluentNumberField>
        </FluentStack>
    </FluentStack>
    
    <FluentStack Orientation="Orientation.Vertical">
        <FluentStack Orientation="Orientation.Horizontal">
            <FluentIcon Value="@(new Icons.Regular.Size24.ArrowMaximize())" Color="@Color.Accent"/>
            <FluentLabel Typo="Typography.H5">Superficie</FluentLabel>
        </FluentStack>
        
        <FluentStack Orientation="Orientation.Horizontal">
            <FluentNumberField TValue="decimal?" Label="Da" @bind-Value="Content.MinSize" autocomplete="off"></FluentNumberField>
            <FluentNumberField TValue="decimal?" Label="A" @bind-Value="Content.MaxSize" autocomplete="off"></FluentNumberField>
        </FluentStack>
    </FluentStack>
    
    <FluentStack Orientation="Orientation.Vertical">
        <FluentStack Orientation="Orientation.Horizontal">
            <FluentIcon Value="@(new Icons.Regular.Size24.Door())" Color="@Color.Accent"/>
            <FluentLabel Typo="Typography.H5">Numero di Stanze</FluentLabel>
        </FluentStack>
        
        <FluentStack Orientation="Orientation.Horizontal">
            <FluentNumberField TValue="int?" Label="Da" @bind-Value="Content.MinRooms" autocomplete="off"></FluentNumberField>
            <FluentNumberField TValue="int?" Label="A" @bind-Value="Content.MaxRooms" autocomplete="off"></FluentNumberField>
        </FluentStack>
    </FluentStack>
    
</FluentStack>

<FluentDialogFooter>
    <FluentButton Appearance="Appearance.Accent"
                  OnClick="@CloseAsync">
        Applica
    </FluentButton>
    <FluentButton Appearance="Appearance.Neutral"
                  OnClick="@(() => Dialog!.CancelAsync())">
        Annulla
    </FluentButton>
</FluentDialogFooter>

@code {
    [Parameter] 
    public ListingFilterDto Content { get; set; } = default!;
    
    [CascadingParameter]
    public FluentDialog? Dialog {get; set; }
    
    private IEnumerable<Option<string>> _selectedOptions = [];
    
    private List<Option<string>> _availableTags = new()
    {
        new Option<string> { Value = "education", Text = "Vicino a scuole" },
        new Option<string> { Value = "commercial", Text = "Vicino a negozi" },
        new Option<string> { Value = "public_transport", Text = "Vicino a servizi pubblici" },
        new Option<string> { Value = "healthcare", Text = "Vicino a servizi sanitari" }
    };
    
    static readonly List<Option<string>> ListingTypes =
    [
        new() { Value = "", Text = "Nessuna preferenza" },
        new() { Value = "SALE", Text = "In vendita" },
        new() { Value = "RENT", Text = "In affitto" }
    ];
    
    static readonly List<Option<string>> ListingEnergeticClasses =
    [
        new() { Value = "", Text = "Nessuna preferenza" },
        new() { Value = "A", Text = "A" },
        new() { Value = "B", Text = "B" },
        new() { Value = "C", Text = "C" },
        new() { Value = "D", Text = "D" },
        new() { Value = "E", Text = "E" },
        new() { Value = "F", Text = "F" },
        new() { Value = "G", Text = "G" }
    ];

    protected override void OnInitialized()
    {
        if (Content.Tags != null && Content.Tags.Any())
        {
            _selectedOptions = _availableTags
            .Where(t => Content.Tags.Contains(t.Value))
            .ToList();
        }
    }

    private async Task CloseAsync()
    {
        Content.Tags = _selectedOptions.Select(o => o.Value).ToList();
        await Dialog!.CloseAsync(Content);
    }

}
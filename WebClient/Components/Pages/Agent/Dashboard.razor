@using DietiEstate.WebClient.ApiService
@using DietiEstate.WebClient.Components.Shared
@using DietiEstate.WebClient.Data.Requests
@using DietiEstate.WebClient.Data.Responses
@rendermode InteractiveServer

@inject ListingApiService ListingApiService

@page "/agent/dashboard"

<FluentGrid Spacing="2">
  <FluentGridItem xs="12" sm="12" md="8">
    
    <FluentStack Orientation="Orientation.Vertical" VerticalGap="20">
      <FluentGrid Style="width: 100%;">
        <FluentGridItem xs="12" sm="4" md="4">
          <DashboardInfoCard Title="Inserzioni"
                             LeftInfo="Vendita" RightInfo="Affitto"
                             LeftNumber="17" RightNumber="8"/>
        </FluentGridItem>
        <FluentGridItem xs="12" sm="4" md="4">
          <DashboardInfoCard Title="Offerte"
                             LeftInfo="Totali" RightInfo="Attesa"
                             LeftNumber="75" RightNumber="28"/>
        </FluentGridItem>
        <FluentGridItem xs="12" sm="4" md="4">
          <DashboardInfoCard Title="Prenotazioni"
                             LeftInfo="Prossime" RightInfo="Attesa"
                             LeftNumber="17" RightNumber="28"/>
        </FluentGridItem>
      </FluentGrid>  
      
      <FluentCard>
        <FluentTabs Size="TabSize.Medium">
          
          <FluentTab Label="Inserzioni" Id="tab-listings">
            
            <PagedDataGrid TItem="ListingResponseDto"
                           DataProvider="GetListingData"
                           PageSize="10">
              <GridColumns>
                <PropertyColumn Title="Nome" Property="@((ListingResponseDto l) => l.Name)" />
                <PropertyColumn Title="Tipologia" Property="@((ListingResponseDto l) => l.Type)" />
                <PropertyColumn Title="Prezzo" Property="@((ListingResponseDto l) => l.Price)" />
                <TemplateColumn Title="DisponibilitÃ " TGridItem="ListingResponseDto">
                  <FluentBadge Appearance="@(context.Available ? Appearance.Neutral : Appearance.Accent )" Circular="true">
                    @(context.Available ? "Disponibile" : "Occupata" )
                  </FluentBadge>
                </TemplateColumn> 
              </GridColumns>
            </PagedDataGrid>
            
          </FluentTab>
          <FluentTab Label="Offerte" Id="tab-offers">
            Content for Offers tab.
          </FluentTab>
          <FluentTab Label="Prenotazioni" Id="tab-bookings">
            Content for Bookings tab.
          </FluentTab>
          
        </FluentTabs>
      </FluentCard>
    </FluentStack>
    
  </FluentGridItem>
  <FluentGridItem xs="12" sm="12" md="4">
    <FluentCard>
      Right side
    </FluentCard>
  </FluentGridItem>
</FluentGrid>

@code {
  ListingFilterDto _filters = new ()
  {
    AgentId = Guid.NewGuid()
  };
  
  
  
  private async Task<PagedResponseDto<ListingResponseDto>>GetListingData(int? pageNumber, int? pageSize)
  {
    return await ListingApiService.GetListingsByAgentIdAsync(_filters, pageNumber, pageSize);
  }

}